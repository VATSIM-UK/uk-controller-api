{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://vatsim.uk/schemas/stand-reservation-plan.schema.json",
  "title": "Stand Reservation Plan Payload",
  "description": "Canonical JSON payload for stand reservation plans (used by planJson and embedded in API submissions).",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "reservations"
  ],
  "properties": {
    "start": {
      "$ref": "#/$defs/dateTime",
      "description": "Default reservation start applied to rows that omit start."
    },
    "end": {
      "$ref": "#/$defs/dateTime",
      "description": "Default reservation end applied to rows that omit end."
    },
    "active_from": {
      "$ref": "#/$defs/dateTime",
      "description": "Alias for start used by some clients."
    },
    "active_to": {
      "$ref": "#/$defs/dateTime",
      "description": "Alias for end used by some clients."
    },
    "reservations": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/reservation"
      },
      "description": "Reservation rows to import once the plan is approved."
    }
  },
  "allOf": [
    {
      "if": {
        "required": [
          "end"
        ]
      },
      "then": {
        "required": [
          "start"
        ]
      }
    },
    {
      "if": {
        "required": [
          "active_to"
        ]
      },
      "then": {
        "required": [
          "active_from"
        ]
      }
    }
  ],
  "$defs": {
    "dateTime": {
      "type": "string",
      "description": "Date/time in either RFC 3339 format or \"YYYY-MM-DD HH:MM:SS\".",
      "pattern": "^(\\d{4}-\\d{2}-\\d{2}[T ]\\d{2}:\\d{2}:\\d{2}(?:Z|[+-]\\d{2}:\\d{2})?)$"
    },
    "airfieldIcao": {
      "type": "string",
      "pattern": "^[A-Z]{4}$",
      "description": "ICAO code in uppercase (e.g. EGLL)."
    },
    "callsign": {
      "type": "string",
      "pattern": "^[A-Z]{2,3}[0-9]{1,4}[A-Z]?$",
      "description": "VATSIM callsign pattern used by reservation validation."
    },
    "reservation": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "stand"
      ],
      "properties": {
        "airfield": {
          "$ref": "#/$defs/airfieldIcao",
          "description": "Arrival airfield ICAO. Use either airfield or airport."
        },
        "airport": {
          "$ref": "#/$defs/airfieldIcao",
          "description": "Alias for airfield. Use either airport or airfield."
        },
        "stand": {
          "type": "string",
          "minLength": 1,
          "maxLength": 10,
          "description": "Stand identifier at the selected airfield."
        },
        "callsign": {
          "$ref": "#/$defs/callsign",
          "description": "Optional exact callsign match."
        },
        "cid": {
          "type": "integer",
          "minimum": 1,
          "description": "Optional VATSIM CID match."
        },
        "origin": {
          "$ref": "#/$defs/airfieldIcao",
          "description": "Optional departure airfield ICAO used for matching."
        },
        "destination": {
          "$ref": "#/$defs/airfieldIcao",
          "description": "Optional destination airfield ICAO used for matching."
        },
        "start": {
          "$ref": "#/$defs/dateTime",
          "description": "Reservation-specific start time. Falls back to top-level start/active_from."
        },
        "end": {
          "$ref": "#/$defs/dateTime",
          "description": "Reservation-specific end time. Falls back to top-level end/active_to."
        }
      },
      "oneOf": [
        {
          "required": [
            "airfield"
          ]
        },
        {
          "required": [
            "airport"
          ]
        }
      ],
      "allOf": [
        {
          "if": {
            "required": [
              "end"
            ]
          },
          "then": {
            "required": [
              "start"
            ]
          }
        }
      ],
      "description": "A single stand reservation row."
    }
  }
}
